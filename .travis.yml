language: python

install:
 - travis_retry sudo apt-get update -qq
 - travis_retry sudo apt-get install -y libnss-db libdb-dev libcurl4-gnutls-dev libgnutls28-dev libldap2-dev libsasl2-dev
 - pip install .
 - travis_retry pip install -r requirements.txt
 - pip install yapf

script:
 - PYTHONTRACEMALLOC=1 python runtests.py -vvv
 - python setup.py install --root=/tmp/nsscache
 #- yapf --diff --recursive . | tee /dev/tty | wc -l | xargs test 0 -eq || echo "Please format your code (with `yapf`)"

python:
 - "3.7"
 - "3.8"
 - "nightly"
matrix:
 fast_finish: true
 allow_failures:
  - python: nightly
